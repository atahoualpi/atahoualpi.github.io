<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8">
		<title>Assingment 2</title>
		<script type="text/javascript" src="d3/d3.js"></script>
		<style type="text/css">
		p {
			color: #377387;
			font-size: 12px;
			font-weight: bold;
			font-family: FontAwesome;
		}
		h4 {
			font-weight: bold;
			font-family: FontAwesome;
		}
		.axis path,
		.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}

		.axis text {
			font-family: sans-serif;
			font-size: 11px;
		}
		.button {
		    background-image: -webkit-linear-gradient(top, #78966E, #377387);
		  background-image: linear-gradient(to bottom, #78966E, #377387);
		    -webkit-box-shadow:rgba(0,0,0,0.2) 0 1px 0 0;
			-moz-box-shadow:rgba(0,0,0,0.2) 0 1px 0 0;
			box-shadow:rgba(0,0,0,0.2) 0 1px 0 0;
			border-bottom-color:#2c46b8;
			border:1px solid #6F8994;
			border-radius:5px;
			-moz-border-radius:5px;
			-webkit-border-radius:5px;
			color:#000;
			font-family:'FontAwesome';
			font-size:16px;
			text-shadow:#6F8994 0 1px 0;
			padding:5px
		}
		button:hover {
    		border: 2px dashed #B8165F;
		}
		button:focus {
    		border: 2px double #B8165F;
		}
		</style>
		<meta charset="utf-8">
		<title>D3 Test</title>
		<script type="text/javascript" src="d3/d3.js"></script>
	</head>
	<h2>Assignment 2A: Simple SVG stuff</h2>
	<p>5 squares with different colors and increasingly transparent. They go from bottom of the SVG element to the top and each of them has a gray boundary of width 2 and dimentsions 80.</p>
	<div id="square"></div>

	<h2>Assignment 2B: One scatter plot and two datasets</h2>
	<h4>Prostitution and vehicle theft crimes in SF districts in 2003 and 2015</h3>
	<div id="text"></div>
	<div id="vis2"></div>
	<body>
		<script type="text/javascript">
			var dataset = [5,10,15,20,25];
			// Width and height of canvas
			var w1 = 600;
			var h1 = 200;
			var padding1 = 1;
			// Create svg element
			svg = d3.select("#square")
				.append("svg")
				.attr("width", w1)
				.attr("height", h1);

			svg.selectAll("rect")
				.data(dataset)
				.enter()
				.append("rect")
				.attr("x",function(d,i){
					return 50*i+padding1;
				})
				.attr("y",function(d,i){
					return 60-i*15;
				})
				.attr("width", 80)
				.attr("height", 80)
				.attr("fill", function(d,i){
					switch(i){
						case 0:
							return "purple"
						case 1:
							return "blue"
						case 2:
							return "green"
						case 3:
							return "yellow"
						case 4:
							return "red"
					}	
				})
				.attr("stroke", "gray")
				.attr("stroke-width", 2)
				.attr("opacity", function(d,i){ 
					return 1.0-0.2*i;
				});
		</script>
		<script type="text/javascript">
			//Variable declaration

			// Width and height of canvas
			var w2 = 700;
			var h2 = 450; 
			// Padding for visualization 
			var padding2 = 30;
			var xScale, yScale;
			var xAxis, yAxis;
			var svg;
			var is2003 = 1;
			var legend;
		</script>
		<script type="text/javascript">
			// Load the file
			var dataset2003 = [];
			var dataset2015 = [];
			d3.csv("Incidents_2003_2015.csv", function(error,data) {
				if(error){
					console.log("error");
				} else{
					// dataset = [];
					for (j=0;j<10;j++){
						dataset2003.push(data[j]);
						dataset2015.push(data[j+10]);
					}	
					console.log("1")
					console.log(dataset2003,dataset2015);

					text();
					makeScale();
					makeScatter();
					makeText();	
					makeAxis();	
					mouseClick();
				}
			});
		</script>
		<script type="text/javascript">
			function text(){
				d3.selectAll("#text")
					.data(dataset2003)
					.append("p")
					.text("Scatter plot showing the change in 2 specific crimes between years 2003 and 2015 in San Francisco districts.")
					.style("color", "#377387")
					.attr("font-family", 'FontAwesome')
					.attr("font-size", "9px")
			};
	
			function makeScale(){
				xScale = d3.scale.linear()
					.domain([0, d3.max(dataset2003, function(d){return parseInt(d.Prostitution)})])
					.range([2*padding2, w2-padding2*2]);
				yScale = d3.scale.linear()
					.domain([0, d3.max(dataset2003, function(d){return parseInt(d.Vehicle_Theft)})])
					.range([h2-padding2, padding2]);

				// Define axis
				xAxis = d3.svg.axis()
						.scale(xScale)
						.orient("bottom")
						.ticks(10);
				yAxis = d3.svg.axis()
						.scale(yScale)
						.orient("left")
						.ticks(10);
            }
		</script>
		<script type="text/javascript">
			function makeScatter(){
				// Create svg element
				svg = d3.select("#vis2")
					.append("svg")
					.attr("width", w2)
					.attr("height", h2);


				// Define clipping path
				svg.append("clipPath")
					.attr("id", "chart-area")
					.append("rect")
					.attr({
						x: padding2+30,
						y: padding2,
						width: w2-padding2*3-30,
						height: h2-padding2*2
					});

				// Create scatter
				svg.append("g")
					.attr("id", "circles")
					.attr("clip-path", "url(#chart-area)")
					.selectAll("circle")
					.data(dataset2003)
					.enter()
					.append("circle")
					.attr("cx", function(d){
						//if(is2003 == 1){
						if(d.Year == '2003'){
							return xScale(parseInt(d.Prostitution));
						}
					})
					.attr("cy", function(d){
						//if(is2003 == 1){
						if(d.Year == '2003'){
							return yScale(parseInt(d.Vehicle_Theft));
						}
					})
					// radius proportional to total crimes of distr
					.attr("r", function(d){
						return parseInt(d.Total_Crimes/20000); 
					})
					.attr("fill", function(d, i){
							return "rgb("+(78+i*10)+","+(128-i*10)+","+(178-i*10)+")"
					});
				}

			function makeText(){
				svg.selectAll("text")
					.data(dataset2003)
					.enter()
					.append("text")
					.text(function(d){
						if(d.Year == '2003'){
							return d.Pd_District;
						}
					})
					.attr("x", function(d){
						return xScale(parseInt(d.Prostitution));
					})
					.attr("y", function(d){
						return yScale(parseInt(d.Vehicle_Theft)+parseInt(d.Total_Crimes/2500));
					})
					.attr("font-family", 'FontAwesome')
					.attr("font-size", "11px")
					.attr("fill", function(d, i){
							return "rgb("+(178-i*10)+","+(128+i)+","+(78+i*10)+")"
					});			
			}
				
			function makeAxis(){
				// Create x-axis
				svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0,"+(h2-padding2)+")")
					.call(xAxis);
				// Create y-axis
				svg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate("+ 2*padding2+",0)")
					.call(yAxis);

				//axis labels
				svg.append("text")
					.attr("class", "x label")
					.attr("text-anchor", "middle")
					.attr("x", w2/2)
					.attr("y", h2)
					.text("PROSTITUTION")
					.attr("font-family", 'FontAwesome')
					.attr("font-size", "14px")
				svg.append("text")
					.attr("class", "y label")
					.attr("text-anchor", "middle")
					.attr("x", -w2/4)
					.attr("y", 2)
					.attr("dy", ".75em")
					.attr("transform", "rotate(-90)")
					.text("VEHICLE THEFT")
					.attr("font-family", 'FontAwesome')
					.attr("font-size", "14px")
			}
		</script>
		<script type="text/javascript">
			function mouseClick(){
				//On click, update with new data			
				d3.select("#button2015")
					.on("click", function() {
						is2003 = -1;
						dataset = dataset2015;
	
						//Update all circles
						svg.selectAll("circle")
						   .data(dataset)
						   .transition()
						   .duration(2000)
						   .attr("cx", function(d){
									return xScale(parseInt(d.Prostitution));
							})
							.attr("cy", function(d){
									return yScale(parseInt(d.Vehicle_Theft));
							})
							.attr("fill", function(d, i){
								return "rgb("+(178-i*10)+","+(128+i)+","+(78+i*10)+")"
							})

						// update labels
						svg.selectAll("text")
							.data(dataset)
							.transition()
						   	.duration(2000)
							.text(function(d){
									return d.Pd_District;
							})
							.attr("x", function(d){
								return xScale(parseInt(d.Prostitution));
							})
							.attr("y", function(d){
								return yScale(parseInt(d.Vehicle_Theft)+parseInt(d.Total_Crimes/2500));
							})
							.attr("font-family", 'FontAwesome')
								.attr("font-size", "11px")
							.attr("fill", function(d, i){
								return "rgb("+(78+i*10)+","+(128-i*10)+","+(178-i*10)+")"
							});	
					 });
				d3.select("#button2003")
					.on("click", function() {
						is2003 = 1;
						dataset = dataset2003;
	
						//Update all circles
						svg.selectAll("circle")
						   .data(dataset)
						   .transition()
						   .duration(2000)
						   .attr("cx", function(d){
									return xScale(parseInt(d.Prostitution));
							})
							.attr("cy", function(d){
									return yScale(parseInt(d.Vehicle_Theft));
							})
							.attr("fill", function(d, i){
								return "rgb("+(78+i*10)+","+(128-i*10)+","+(178-i*10)+")"
							})

						// update labels
						svg.selectAll("text")
							.data(dataset)
							.transition()
						   	.duration(2000)
							.text(function(d){
									return d.Pd_District;
							})
							.attr("x", function(d){
								return xScale(parseInt(d.Prostitution));
							})
							.attr("y", function(d){
								return yScale(parseInt(d.Vehicle_Theft)+parseInt(d.Total_Crimes/2500));
							})
							.attr("font-family", 'FontAwesome')
								.attr("font-size", "11px")
							.attr("fill", function(d, i){
								return "rgb("+(178-i*10)+","+(128+i)+","+(78+i*10)+")"
							});	
					 });
			}
		</script>
	</body>
	<button id="button2003" class="button">2003</button>
	<button id="button2015" class="button">2015</button>
</html>